<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="shortcut icon" href="{{url_for('static',filename='images/logo3.jpg')}}" type="image/x-icon">
    <link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap.min.css')}}">
</head>
<body class="bg-secondary">
  {% include "header.html" %}

   <main class=" row d-flex flex-column align-items-center container-fluid  m-0" style="margin-top: 100px;">
    <div class="col bg-info px-3 pb-4" style="
    max-width: 450px;
    border-radius: 30px;
    padding: 20px 10px;">
        <div class="row  bg-info d-flex flex-column justify-content-center align-items-center m-0 ">
            <img src={{imgdata}} alt="" class="pt-2 mb-2" style="height: 100px; width: 150px;">
            <h2 class="text-center">{{user_data[1]}} {{user_data[2]}}</h2>
            <h5 class="text-center">{{user_data[4]}}</h5>
        </div><br>
        <div class="row">
            <h2>User info</h2>
            <div class="col">
                <p>First Name</p>
                <p>Last Name</p>
                <p>Email</p>
                <p>Phone</p>
                <p>Address</p>
            </div>
            <div class="col">
                <p>{{user_data[1]}}</p>
                <p>{{user_data[2]}}</p>
                <p>{{user_data[4]}}</p>
                <p>{{user_data[3]}}</p>
                <p>{{user_data[5]}}</p>
            </div>
        </div>
        <button class="btn w-100 btn-outline-light w-100" data-bs-toggle="modal" data-bs-target="#login">Edit Profile</button>
    </div>
    

    <div id="login" class="modal modal-fullscreen">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Atrifusion</div>
                    <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form action="" id="updateprofile" enctype="multipart/form-data">
                        <div class=" d-flex align-items-center justify-content-center">
                            <img src={{imgdata}} alt="" id="img" class="rounded-circle bg-info" style="width:100px;height: 100px;">
                        </div>
                        <br>
                        <div class="row">
                            <label for="img">Update image</label>
                            <input type="file" id="imageinput" accept="image/*"/>
                          </div>
                          <br>
                        <div class="form-floating mb-3 mt-3">
                            <input type="text" value={{user_data[1]}}  class="form-control" id="firstname" placeholder="Enter First Name" name="fname">
                            <label for="name">First Name</label>
                          </div>
                          <div class="form-floating mb-3 mt-3">
                            <input type="text" value={{user_data[2]}} class="form-control" id="lastname" placeholder="Enter Last Name" name="lname">
                            <label for="last">Last Name </label>
                          </div>
                       
                          <div class="form-floating mt-3 mb-3">
                            <input type="text"  class="form-control"   id="pwd" placeholder="Enter password" name="pswd">
                            <label for="pwd">Enter new Password</label>
                          </div>
                          <div class="form-floating mt-3 mb-3">
                            <input type="tel" value={{user_data[3]}} class="form-control" id="phoneno" placeholder="Enter phonenumber" name="phoneno">
                            <label for="phoneno">Contact Number</label>
                          </div>
                          <div class="form-floating mt-3 mb-3">
                            <input type="text" value={{user_data[5]}} class="form-control"  id="addr" placeholder="Enter Address" name="addr">
                            <label for="addr">Address</label>
                          </div>
                          <button type="submit" class="btn btn-primary w-100">Update Profile</button>
                      
                    </form>
                </div>
            </div>
        </div>
    </div>   

    </main>
   <br>
   <hr>
   {% include "modal.html" %}

    {% include "footer.html" %}

   <script src="{{url_for('static',filename='js/bootstrap.bundle.min.js')}}"></script>
   <script src="{{url_for('static',filename='js/foot.js')}}"></script>
   <script>
    let profimg;  
    const upform=document.getElementById('updateprofile')
    const imgip= document.getElementById('imageinput');
    const img=document.getElementById('img');
    imgip.addEventListener('input',()=>{
      if(imgip.files && imgip.files[0]){
        const reader =new FileReader();
        reader.onload= function(e){
          console.log(typeof e.target.result);
          img.src=e.target.result;
        };
        reader.readAsDataURL(imgip.files[0])
      }
      console.log(profimg);
    })
      
    upform.addEventListener('submit',()=>{
        event.preventDefault()
        console.log(profimg);
        profimg=img.src
        const fname=document.getElementById('firstname').value
        const lname=document.getElementById('lastname').value
        const addr=document.getElementById('addr').value
        const phoneno=document.getElementById('phoneno').value
        const pwd=document.getElementById('pwd').value
        const newprod={
            fname:fname,
            lname:lname,
            addr:addr,
            phone:phoneno,
            pwd:pwd,
            pimgarr:profimg,
        }
            
        fetch(`${window.origin}/artifusion/buyer/userprofile/edit`,{
            method:'POST',
            headers:{
                'content-Type':'application/json',
            },
            body:JSON.stringify(newprod),
        })
        .then(response=>response.json())
        .then(data=>{
            if(data.status_code==200){
                window.location.href='/artifusion/buyer'
                console.log('Profile info updated successfully')
            }
            else if(data.status_code==404){
                console.log('the json data is not received has some problem')
                window.location.href='/artifusion/buyer'
            }
            else{
                console.log('server prolem')
                window.location.href='/artifusion/buyer'
            }
        })  
        .catch(error=>{

        })      
    })
        
 </script>
</body>
</html>