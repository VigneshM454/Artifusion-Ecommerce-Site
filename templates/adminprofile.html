<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review</title>
    <link rel="shortcut icon" href="{{url_for('static',filename='images/logo3.jpg')}}" type="image/x-icon">
    <link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap.min.css')}}">
</head>
<body>
    {% include "adminheader.html" %}

    
    <main class=" row d-flex flex-column align-items-center container-fluid  m-0" style="background-color: bisque;margin-top: 100px;">
    
        <div class="col bg-success px-3 pb-3" style="max-width:450px">
            <div class="row  bg-success d-flex flex-column justify-content-center align-items-center m-0 ">
                <img src={{imgdata}} alt="" class="pt-2 mb-2" style="height: 100px; width: 150px;">
                <h2 class="text-center">{{user_data[1]}} {{user_data[2]}}</h2>
                <h5 class="text-center">{{user_data[3]}}</h5>
            </div><br>
            <div class="row">
                <h2>User info</h2>
                <div class="col">
                    <p>First Name</p>
                    <p>Last Name</p>
                    <p>Email</p>
                    <p>Phone</p>
                </div>
                <div class="col">
                    <p>{{user_data[1]}}</p>
                    <p>{{user_data[2]}}</p>
                    <p>{{user_data[4]}}</p>
                    <p>{{user_data[3]}}</p>
                </div>
            </div>
       <button class="btn w-100 btn-outline-info w-100" data-bs-toggle="modal" data-bs-target="#login">Edit Profile</button>
        </div>
    
        <div id="login" class="modal modal-fullscreen">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">Atrifusion</div>
                        <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form action="" id="updatesprofile" enctype="multipart/form-data">
                            <div class=" d-flex align-items-center justify-content-center">
                                <img src={{imgdata}} alt="" id="img" class="rounded-circle bg-info" style="width:100px;height: 100px;">
                            </div>
                            <br>
                            <div class="row">
                                <label for="img">Update image</label>
                                <input type="file" id="imageinput" accept="image/*"/>
                              </div>
                              <br>
                            <div class="form-floating mb-3 mt-3">
                                <input type="text" value={{user_data[1]}}  class="form-control" id="firstname" placeholder="Enter First Name" name="fname">
                                <label for="name">First Name</label>
                              </div>
                              <div class="form-floating mb-3 mt-3">
                                <input type="text" value={{user_data[2]}} class="form-control" id="lastname" placeholder="Enter Last Name" name="lname">
                                <label for="last">Last Name </label>
                              </div>
                              <div class="form-floating mt-3 mb-3">
                                <input type="text"  class="form-control"    id="pwd" placeholder="Enter password" name="pswd">
                                <label for="pwd">Enter new Password</label>
                              </div>
                              <div class="form-floating mt-3 mb-3">
                                <input type="tel" value={{user_data[3]}} class="form-control" id="phoneno" placeholder="Enter phonenumber" name="phoneno">
                                <label for="phoneno">Contact Number</label>
                              </div>
                              <button type="submit" class="btn btn-primary w-100" data-bs-dismiss="modal">Update Profile</button>
                          
                        </form>
                    </div>
                </div>
            </div>
        </div>   
        
    </main>

    {% include "modal.html" %}

     {% include "footer.html" %}
     <script src="{{url_for('static',filename='js/bootstrap.bundle.min.js')}}"></script>
     <script src="{{url_for('static',filename='js/foot.js')}}"></script>
     <script>
        let profimg;  
        const upform=document.getElementById('updatesprofile')
        const imgip= document.getElementById('imageinput');
        const img=document.getElementById('img');
        imgip.addEventListener('input',()=>{
          if(imgip.files && imgip.files[0]){
            const reader =new FileReader();
            reader.onload= function(e){
              console.log(typeof e.target.result);
    
              img.src=e.target.result;
              profimg=e.target.result;
              console.log(profimg);
              
            };
            reader.readAsDataURL(imgip.files[0])
          }
          console.log(profimg);
        })
        profimg=img.src;

          
        upform.addEventListener('submit',()=>{
            event.preventDefault()
            console.log(profimg);
    
            const fname=document.getElementById('firstname').value
            const lname=document.getElementById('lastname').value
            const phoneno=document.getElementById('phoneno').value
            const pwd=document.getElementById('pwd').value
            
            console.log('profimg = ',profimg);
            const newprod={
                fname:fname,
                lname:lname,
                phone:phoneno,
                pwd:pwd,
                pimgarr:profimg,
            }
            console.log(newprod);
            /*
            if(npname!=''&& npdesc!='' && npprice!='' && npqty>0 && imgarr.length>=1){
                alert('success') 
                alert(srcarr[0])
                console.log(srcarr[0]);
                console.log(newprod);
              */    
                fetch(`${window.origin}/artifusion/admin/userprofile/edit`,{
                    method:'POST',
                    headers:{
                        'content-Type':'application/json',
                    },
                    body:JSON.stringify(newprod),
                })
                .then(response=>response.json())
                .then(data=>{
                    if(data.status_code==200){
                        //window.location.href='/artifusion/seller/products'
                        alert('Profile info updated successfully')
                        location.reload()
                    }
                    else if(data.status_code==404){
                        alert('the json data is not received has some problem')
                        window.location.href='/artifusion/admin/home'
                    }
                    else{
                        alert('server prolem')
                        window.location.href='/artifusion/admin/home'
                    }
                })  
                .catch(error=>{
    
                })      
          /*  }
            else{
                alert('please fill out the necessary details')
            }*/
        })
            
     </script>
</body>
</html>